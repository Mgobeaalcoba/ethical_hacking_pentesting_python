import os
import json
from shodan import Shodan
from dotenv import load_dotenv

def main():
    load_dotenv()
    # En Python 3 no es necesario cambiar el encoding global
    print("UTF-8 encoding is handled automatically in Python 3")
    key = os.getenv("SHODAN_KEY2")
    print(key)
    engine = Shodan(key=key)
    print(engine)
    try:
        query = engine.search("apache")  # Busca algo más genérico para testear
        query_json = json.dumps(query, indent=4)
        print(query_json)
        file = open('shodan_extract.json', mode='w+')
        file.write(query_json)
        file.close()
    except Exception as e:
        print(e)

if __name__ == '__main__':
    main()

# https://help.shodan.io/the-basics/account-faq