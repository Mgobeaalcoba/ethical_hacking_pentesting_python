import mechanize
import argparse
from bs4 import BeautifulSoup

parser = argparse.ArgumentParser(description="Navegador por terminal!!!")
parser.add_argument('-b', '--buscar', help="Opción a buscar")
parser = parser.parse_args()

def main():
    busqueda = parser.buscar
    if busqueda:
        print(f"Busqueda: {busqueda}")
        # Configuro mi navegador
        bus = mechanize.Browser()
        bus.set_handle_robots(False)
        bus.set_handle_equiv(False)
        # Agrego headers a mi navegador
        bus.addheaders = [("User-Agent","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36")]
        # Abro una página con el navegador
        bus.open("https://www.google.com")
        # Busco si hay formularios en mi pagina web: 
        # for form in bus.forms():
        #     print(form)

        bus.select_form(nr=0) # Primer elemento del Tipo TextareaControl
        bus['q'] = busqueda # 'q' es el nombre de la variable que recibe el TextareaControl: <TextareaControl(q=)>
        bus.submit()
        # print(bus.response().read()) # Los resultados así obtenidos son ilegibles por lo que voy a parsearlos con BeatifoulSoup
        page_bs4 = BeautifulSoup(bus.response().read(), 'html5lib')
        # print(page_bs4)
        for link in page_bs4.find_all('a'): # Recorro una lista de todos los elementos html 'a' de mi pagina
            href = link.get('href') # Imprimo de cada elemento 'a' su sección 'href' que es donde tendré mi pagina a la que redirecciona.
            # href = href.replace('/url?q=','')
            try:
                if href.startswith("https://"):
                    print(href)
            except AttributeError:
                continue

    else:
        print("No hay introducido nada que buscar...")

if __name__ == '__main__':
    try:
        main()
    except KeyboardInterrupt:
        print("Saliendo...")
        exit()