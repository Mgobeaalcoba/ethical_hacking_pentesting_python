import requests
import json
import os

def main():
    url = 'https://www.rollingstone.com/wp-json/wp/v2/users' # La terminación wp-json/wp/v2/users de un sitio wordpress me muestra los usuarios registrados en el mismo.
    # https://gsas.harvard.edu/

    cabecera = {
        "User-Agent": "Firefox"
    }

    peticion = requests.get(url=url, headers=cabecera)
    peticion_json = peticion.json()

    # Procesar el JSON (aquí simplemente lo imprimimos)
    json_formatted = json.dumps(peticion_json, indent=2)
    # print(json_formatted)

    # Crear una lista para guardar los nombres
    nombres = []

    # Iterar sobre el JSON y extraer los nombres
    for usuario in peticion_json:
        if 'name' in usuario:
            nombres.append(usuario['name'])
            print(usuario['name'])
        # print(f"User: {usuario}")
    print("...")

    # Imprimir la lista de nombres
    print(nombres)

    # Obtener el directorio actual del script
    current_directory = os.path.dirname(os.path.abspath(__file__))
            
    # Crear la ruta completa del archivo .json
    file_path = os.path.join(current_directory, 'usuarios.json')
    file_path2 = os.path.join(current_directory, 'usuarios.txt') 

    # Escribir el JSON formateado en el archivo
    with open(file_path, 'w', encoding='utf-8') as file:
        file.write(json_formatted)
    
    # Escribir un txt solo con los nombres de los usuarios:
    with open(file_path2, 'w', encoding='utf-8') as file2:
        for user in nombres:
            file2.write(user+'\n')
    
if __name__ == '__main__':
    try:
        main()
    except KeyboardInterrupt:
        print("Saliendo...")
        exit()
